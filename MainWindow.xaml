<Window x:Class="LaserCutHMI.Prototype.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:LaserCutHMI.Prototype.Models"
        xmlns:conv="clr-namespace:LaserCutHMI.Prototype.Converters"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        Title="LaserCut HMI" Height="900" Width="1280"
        Loaded="Window_Loaded"
        x:Name="Root">

    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveParamsCmd}"/>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenNcCmd}"/>
        <KeyBinding Gesture="F5" Command="{Binding CheckAllCmd}"/>

        <KeyBinding Gesture="Ctrl+1" Command="{Binding NavigateCmd}" CommandParameter="Giris"/>
        <KeyBinding Gesture="Ctrl+2" Command="{Binding NavigateCmd}" CommandParameter="Parametre"/>
        <KeyBinding Gesture="Ctrl+3" Command="{Binding NavigateCmd}" CommandParameter="Uretim"/>
        <KeyBinding Gesture="Ctrl+4" Command="{Binding NavigateCmd}" CommandParameter="Ozet"/>
        <KeyBinding Gesture="Ctrl+5" Command="{Binding NavigateCmd}" CommandParameter="Yetkilendirme"/>

        <KeyBinding Gesture="Ctrl+6" Command="{Binding NavigateCmd}" CommandParameter="Analiz"/>

        <KeyBinding Gesture="Ctrl+7" Command="{Binding NavigateCmd}" CommandParameter="KPI"/>

        <KeyBinding Gesture="Ctrl+8" Command="{Binding NavigateCmd}" CommandParameter="Dogrulama"/>

    </Window.InputBindings>


    <Window.Resources>
        <conv:EnumToVisibilityConverter x:Key="EnumToVis"/>
        <conv:PressureToBrushConverter x:Key="PressureToBrush"/>
        <conv:BooleanToBrushConverter x:Key="BooleanToBrushConverter"/>

        <Style x:Key="NavHeaderStyle" TargetType="Button">
            <Setter Property="Background" Value="#f2f2f2"/>
            <Setter Property="BorderBrush" Value="#d0d0d0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="BoolLampStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="14"/>
            <Setter Property="Height" Value="14"/>
            <Setter Property="Stroke" Value="#66000000"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="Fill" Value="Red"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding}" Value="True">
                    <Setter Property="Fill" Value="LimeGreen"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- header + sekmeler -->
            <RowDefinition Height="*"/>
            <!-- içerik -->
            <RowDefinition Height="Auto"/>
            <!-- alt buton bar -->
            <RowDefinition Height="208"/>
            <!-- events -->
            <RowDefinition Height="Auto"/>
            <!-- status -->
        </Grid.RowDefinitions>

        <!-- ÜST BAŞLIK + SEKMELER -->
        <StackPanel Grid.Row="0" Margin="0,0,0,8">
            <TextBlock Text="MRT HMI — Student Prototype" FontSize="20" FontWeight="Bold" Margin="0,0,0,6"/>
            <UniformGrid Rows="1" Columns="9">
                <!-- 'Giris' -->
                <Button Style="{StaticResource NavHeaderStyle}" Content="Görünüm"    Command="{Binding NavigateCmd}" CommandParameter="Giris"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Operatör"   Command="{Binding NavigateCmd}" CommandParameter="Operator"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Parametre"  Command="{Binding NavigateCmd}" CommandParameter="Parametre"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Üretim"     Command="{Binding NavigateCmd}" CommandParameter="Uretim"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Üretim Özeti" Command="{Binding NavigateCmd}" CommandParameter="Ozet"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Yetki" 
                        Background="#FFFBF0" BorderBrush="#E6A21F" 
                        Command="{Binding NavigateCmd}" CommandParameter="Yetkilendirme"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Analiz" 
                        Background="#F0F8FF" BorderBrush="#B0C4DE"
                        Command="{Binding NavigateCmd}" CommandParameter="Analiz"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="KPI" 
                        Background="#F5F5DC" BorderBrush="#D2B48C"
                        Command="{Binding NavigateCmd}" CommandParameter="KPI"/>
                <Button Style="{StaticResource NavHeaderStyle}" Content="Doğrulama" 
                        Background="#E6E6FA" BorderBrush="#9370DB"
                        Command="{Binding NavigateCmd}" CommandParameter="Dogrulama"/>

            </UniformGrid>
        </StackPanel>

        <!-- ========== SAYFA: GÖRÜNÜM  ========== -->
        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Giris}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- Hazırlık LED'leri + Hataları kontrol et -->
            <GroupBox Header="Hazırlık Durumu" Grid.Column="0" Margin="0,0,8,0">
                <DockPanel LastChildFill="True" Margin="8">
                    <Button Content="Hataları kontrol et"
                            Command="{Binding CheckAllCmd}"
                            Padding="10,6" DockPanel.Dock="Top" HorizontalAlignment="Right" Margin="0,0,0,8"/>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding DoorsOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Kapılar kapalı"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding VentOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Havalandırma açık"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding TableOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Tabla sac yüklü"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding LaserOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Lazer başlık OK"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding ResonatorOnOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Rezonatör açık"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding GasOverallOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Seçili gaz bağlı &amp; %&gt;5"/>
                        </StackPanel>
                    </StackPanel>
                </DockPanel>
            </GroupBox>

            <!-- Eksenler + Sıcaklıklar -->
            <StackPanel Grid.Column="1">
                <GroupBox Header="Eksenler" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <TextBlock FontSize="16"><Run Text="X = "/><Run Text="{Binding XPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                        <TextBlock FontSize="16"><Run Text="Y = "/><Run Text="{Binding YPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                        <TextBlock FontSize="16"><Run Text="Z = "/><Run Text="{Binding ZPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                    </StackPanel>
                </GroupBox>
                <GroupBox Header="Sıcaklıklar">
                    <StackPanel Margin="8">
                        <TextBlock><Run Text="Başlık: "/><Run Text="{Binding HeadTemp, StringFormat={}{0:F1}}"/><Run Text=" °C"/></TextBlock>
                        <TextBlock><Run Text="Makine içi: "/><Run Text="{Binding InsideTemp, StringFormat={}{0:F1}}"/><Run Text=" °C"/></TextBlock>
                        <TextBlock><Run Text="Dış ortam: "/><Run Text="{Binding OutsideTemp, StringFormat={}{0:F1}}"/><Run Text=" °C"/></TextBlock>
                    </StackPanel>
                </GroupBox>
            </StackPanel>

            <!-- Gazlar -->
            <GroupBox Header="Gazlar (50 L)" Grid.Column="2">
                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" Margin="0,3,0,3">
                        <TextBlock Text="Air" Width="70"/>
                        <TextBlock Text="{Binding Checks.Tanks[0].Connected}" Width="60"/>
                        <ProgressBar Minimum="0" Maximum="100" Width="180" Height="12" Value="{Binding Checks.Tanks[0].LevelPercent}" Margin="8,0,0,0"/>
                        <TextBlock Text="{Binding Checks.Tanks[0].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,3,0,3">
                        <TextBlock Text="Oxygen" Width="70"/>
                        <TextBlock Text="{Binding Checks.Tanks[1].Connected}" Width="60"/>
                        <ProgressBar Minimum="0" Maximum="100" Width="180" Height="12" Value="{Binding Checks.Tanks[1].LevelPercent}" Margin="8,0,0,0"/>
                        <TextBlock Text="{Binding Checks.Tanks[1].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,3,0,8">
                        <TextBlock Text="Nitrogen" Width="70"/>
                        <TextBlock Text="{Binding Checks.Tanks[2].Connected}" Width="60"/>
                        <ProgressBar Minimum="0" Maximum="100" Width="180" Height="12" Value="{Binding Checks.Tanks[2].LevelPercent}" Margin="8,0,0,0"/>
                        <TextBlock Text="{Binding Checks.Tanks[2].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                    </StackPanel>
                    <Button Content="Gaz tüplerini değiştir"
                    Margin="0,8,0,0"
                    Padding="10,6"
                    Command="{Binding ReplaceGasCmd}"
                    HorizontalAlignment="Left"/>
                </StackPanel>
            </GroupBox>

        </Grid>

        <!-- ========== SAYFA: PARAMETRE  ========== -->
        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Parametre}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Header="Seçimler" Grid.Column="0" Margin="0,0,8,0">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Materyal:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="0" Grid.Column="1"
                              ItemsSource="{Binding Materials}"
                              SelectedItem="{Binding SelectedMaterial}" MinWidth="180"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Kalınlık (mm):" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <ComboBox Grid.Row="1" Grid.Column="1"
                              ItemsSource="{Binding Thicknesses}"
                              SelectedItem="{Binding SelectedThickness}" MinWidth="180" Margin="0,6,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Gaz:" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <ComboBox Grid.Row="2" Grid.Column="1"
                              ItemsSource="{Binding Gases}"
                              SelectedItem="{Binding SelectedGas}" MinWidth="180" Margin="0,6,0,0"/>
                </Grid>
            </GroupBox>

            <GroupBox Header="Ekstra Parametreler " Grid.Column="1">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="160"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Power (W):" VerticalAlignment="Center"/>
                    <TextBox   Grid.Row="0" Grid.Column="1"
                               Text="{Binding CurrentParams.PowerW, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Frequency:" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <TextBox   Grid.Row="1" Grid.Column="1"
                               Text="{Binding CurrentParams.Frequency, UpdateSourceTrigger=PropertyChanged}" Margin="0,6,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Duty (%):" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <TextBox   Grid.Row="2" Grid.Column="1"
                               Text="{Binding CurrentParams.Duty, UpdateSourceTrigger=PropertyChanged}" Margin="0,6,0,0"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Pressure (bar):" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <TextBox   Grid.Row="3" Grid.Column="1"
                               Text="{Binding CurrentParams.PressureBar, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F1}}"
                               Margin="0,6,0,0"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Cutting Height (mm):" VerticalAlignment="Center" Margin="0,6,0,0"/>
                    <TextBox   Grid.Row="4" Grid.Column="1"
                               Text="{Binding CurrentParams.CuttingHeightMm, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F2}}"
                               Margin="0,6,0,0"/>

                    <!-- Yükle / Kaydet / İndir -->
                    <StackPanel Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                        <Button Content="Yükle"  Command="{Binding LoadParamsCmd}"   Padding="10,6" Margin="0,0,8,0"/>
                        <Button Content="Kaydet" Command="{Binding SaveParamsCmd}"   Padding="10,6" Margin="0,0,8,0"/>
                        <Button Content="İndir"  Command="{Binding ExportParamsCmd}" Padding="10,6"/>

                    </StackPanel>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- ========== SAYFA: ÜRETİM  ========== -->
        <Grid Grid.Row="1" Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Uretim}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2.2*"/>
                <ColumnDefinition Width="1.8*"/>
            </Grid.ColumnDefinitions>

            <!-- SOL: Program + Seçimler + Hazırlık -->
            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                <GroupBox Header="Program" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <WrapPanel>
                            <Button Content="NC Aç..." Command="{Binding OpenNcCmd}" Padding="10,6" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding NcPath}" TextTrimming="CharacterEllipsis" ToolTip="{Binding NcPath}" VerticalAlignment="Center"/>
                        </WrapPanel>
                        <TextBlock Text="{Binding CurrentLine, StringFormat=Satır ...}"
           Visibility="Collapsed"/>

                        <ProgressBar Height="18" Margin="0,6,0,0"
                                     Minimum="0"
                                     Maximum="{Binding Path=NcLines.Count, Mode=OneWay}"
                                     Value="{Binding CurrentLine}"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Seçimler" Margin="0,0,0,8">
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Materyal:" VerticalAlignment="Center"/>
                        <ComboBox Grid.Row="0" Grid.Column="1"
                                  ItemsSource="{Binding Materials}"
                                  SelectedItem="{Binding SelectedMaterial}" MinWidth="180"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Kalınlık (mm):" VerticalAlignment="Center" Margin="0,6,0,0"/>
                        <ComboBox Grid.Row="1" Grid.Column="1"
                                  ItemsSource="{Binding Thicknesses}"
                                  SelectedItem="{Binding SelectedThickness}" MinWidth="180" Margin="0,6,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Gaz:" VerticalAlignment="Center" Margin="0,6,0,0"/>
                        <ComboBox Grid.Row="2" Grid.Column="1"
                                  ItemsSource="{Binding Gases}"
                                  SelectedItem="{Binding SelectedGas}" MinWidth="180" Margin="0,6,0,0"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Hazırlık Durumu">
                    <StackPanel Margin="8">
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding DoorsOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Kapılar kapalı"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding VentOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Havalandırma açık"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding TableOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Tabla sac yüklü"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding LaserOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Lazer başlık OK"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding ResonatorOnOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Rezonatör açık"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding GasOverallOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Seçili gaz bağlı &amp; %&gt;5"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding RuleOk}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text="Gaz/kalınlık kuralı uygun"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,2">
                            <Ellipse DataContext="{Binding NcLoaded}" Style="{StaticResource BoolLampStyle}"/>
                            <TextBlock Text=".nc dosyası seçildi"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
            </StackPanel>

            <!-- ORTA: Canlı İzleme -->
            <StackPanel Grid.Column="1" Margin="0,0,8,0">
                <GroupBox Header="Anlık Göstergeler" Margin="0,0,0,8">
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Basınç (bar)" FontWeight="SemiBold"/>
                            <ProgressBar Minimum="0" Maximum="15" Height="18"
                                Value="{Binding PressureBar}" Margin="0,4,0,0"
                                Foreground="{Binding PressureBar, Converter={StaticResource PressureToBrush}}"/>
                            <TextBlock Text="{Binding PressureBar, StringFormat={}{0:F1} bar}" Foreground="Gray" Margin="0,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="16,0,0,0">
                            <TextBlock Text="Lazer Gücü (W)" FontWeight="SemiBold"/>
                            <ProgressBar Minimum="0" Maximum="4000" Height="18" Value="{Binding LaserPowerLive}" Margin="0,4,0,0"/>
                            <TextBlock Text="{Binding LaserPowerLive, StringFormat={}{0} W}" Foreground="Gray" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Kesim Hızı ve İlerleme" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <TextBlock Text="{Binding CurrentSpeedMmSec, StringFormat=Anlık Hız: {0:F1} mm/sn}" FontSize="16"/>
                        <TextBlock Text="{Binding JobCutMm, StringFormat=Toplam Kesilen: {0:F0} mm}" FontSize="16" Margin="0,4,0,0"/>
                        <ProgressBar Height="18" Margin="0,6,0,0"
                                     Minimum="0" Maximum="{Binding JobTargetMm}" Value="{Binding JobCutMm}"/>
                        <TextBlock Text="{Binding JobElapsedSec, StringFormat=Süre: {0:F1} sn}" Margin="0,6,0,0"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Feed / Power Grafikleri">
                    <StackPanel Margin="8">
                        <Border BorderBrush="#DDD" BorderThickness="1" Padding="6" Margin="0,0,0,8">
                            <Grid Width="600" Height="120">
                                <Polyline Points="{Binding FeedPoints}" Stroke="SteelBlue" StrokeThickness="2"/>
                            </Grid>
                        </Border>
                        <Border BorderBrush="#DDD" BorderThickness="1" Padding="6">
                            <Grid Width="600" Height="120">
                                <Polyline Points="{Binding PowerPoints}" Stroke="Firebrick" StrokeThickness="2"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </GroupBox>
            </StackPanel>

            <!-- SAĞ: Makine Durumu -->
            <StackPanel Grid.Column="2">
                <GroupBox Header="Eksenler" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <TextBlock FontSize="16"><Run Text="X = "/><Run Text="{Binding XPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                        <TextBlock FontSize="16"><Run Text="Y = "/><Run Text="{Binding YPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                        <TextBlock FontSize="16"><Run Text="Z = "/><Run Text="{Binding ZPos, StringFormat={}{0:F2}}"/><Run Text=" mm"/></TextBlock>
                        <TextBlock Text="Başlangıç 0,0,300 — kesim başında 50,50,0" Foreground="Gray" Margin="0,6,0,0"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Gazlar (50 L)">
                    <StackPanel Margin="8">
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,3">
                            <TextBlock Text="Air" Width="70"/>
                            <TextBlock Text="{Binding Checks.Tanks[0].Connected}" Width="60"/>
                            <ProgressBar Minimum="0" Maximum="100" Width="160" Height="12" Value="{Binding Checks.Tanks[0].LevelPercent}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Checks.Tanks[0].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,3">
                            <TextBlock Text="Oxygen" Width="70"/>
                            <TextBlock Text="{Binding Checks.Tanks[1].Connected}" Width="60"/>
                            <ProgressBar Minimum="0" Maximum="100" Width="160" Height="12" Value="{Binding Checks.Tanks[1].LevelPercent}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Checks.Tanks[1].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,3">
                            <TextBlock Text="Test" Width="70"/>
                            <TextBlock Text="{Binding Checks.Tanks[1].Connected}" Width="60"/>
                            <ProgressBar Minimum="0" Maximum="100" Width="160" Height="12" Value="{Binding Checks.Tanks[1].LevelPercent}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Checks.Tanks[1].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,8">
                            <TextBlock Text="Nitrogen" Width="70"/>
                            <TextBlock Text="{Binding Checks.Tanks[2].Connected}" Width="60"/>
                            <ProgressBar Minimum="0" Maximum="100" Width="160" Height="12" Value="{Binding Checks.Tanks[2].LevelPercent}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Checks.Tanks[2].LevelPercent, StringFormat={}{0:F1}%}" Margin="8,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1" Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Uretim}">
        </Grid>

        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Ozet}">
            <DockPanel Margin="12">
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Başlangıç Tarihi:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <DatePicker SelectedDate="{Binding OzetBaslangic}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox Text="{Binding OzetBaslangicSaat}" Width="50" VerticalAlignment="Center" Margin="0,0,15,0" ToolTip="Saat (HH:mm)"/>
                    
                    <TextBlock Text="Bitiş Tarihi:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <DatePicker SelectedDate="{Binding OzetBitis}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox Text="{Binding OzetBitisSaat}" Width="50" VerticalAlignment="Center" Margin="0,0,15,0" ToolTip="Saat (HH:mm)"/>
                    <Button Content="Veri Getir" 
                            Command="{Binding LoadOzetDataCmd}" 
                            Padding="12,6" FontWeight="Bold"/>
                </StackPanel>

                <UniformGrid DockPanel.Dock="Top" Rows="1" Columns="2" Margin="0,10,0,10">
                    <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                        <StackPanel>
                            <TextBlock Text="TOPLAM KESİM (mm)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                            <TextBlock Text="{Binding OzetToplamKesim, StringFormat={}{0:F0} mm}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                        <StackPanel>
                            <TextBlock Text="ORTALAMA SÜRE (sn)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                            <TextBlock Text="{Binding OzetOrtalamaSure, StringFormat={}{0:F1} sn}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>

                <GroupBox Header="Geçmiş Üretim Kayıtları" Margin="0,10,0,0">
                    <ListView ItemsSource="{Binding OzetUretimKayitlari}"
                              ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Zaman" Width="170">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding When, StringFormat=dd.MM.yyyy HH:mm:ss}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="NC Dosyası" Width="200" DisplayMemberBinding="{Binding NcName}"/>
                                <GridViewColumn Header="Malzeme" Width="120" DisplayMemberBinding="{Binding Material}"/>
                                <GridViewColumn Header="Gaz" Width="100" DisplayMemberBinding="{Binding Gas}"/>
                                <GridViewColumn Header="Kalınlık" Width="70" DisplayMemberBinding="{Binding ThicknessMm, StringFormat={}{0} mm}"/>
                                <GridViewColumn Header="Süre (sn)" Width="80" DisplayMemberBinding="{Binding DurationSec, StringFormat={}{0:F1}}"/>
                                <GridViewColumn Header="Kesim (mm)" Width="90" DisplayMemberBinding="{Binding CutLengthMm, StringFormat={}{0:F0}}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </GroupBox>

            </DockPanel>
        </Grid>

        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Yetkilendirme}">
            <StackPanel Width="450" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="20">
                <GroupBox Header="Yetkili Oturumu Açma" Padding="15">
                    <StackPanel>
                        <TextBlock Text="Kritik parametreleri (güç, frekans vb.) değiştirmek için lütfen 'Servis' veya 'Admin' erişim kodunuzu girin." 
                                   TextWrapping="Wrap" Margin="0,0,0,15"/>

                        <GroupBox Header="1. Adım: Kod İste" Margin="0,0,0,10" Padding="10">
                            <UniformGrid Columns="2" Rows="1">
                                <Button Content="Admin Kodu İste"
                                        Command="{Binding RequestAdminCodeCmd}"
                                        Background="LightYellow" Margin="0,0,5,0" Padding="8"/>
                                <Button Content="Servis Kodu İste"
                                        Command="{Binding RequestServisCodeCmd}"
                                        Background="LightCyan" Margin="5,0,0,0" Padding="8"/>
                            </UniformGrid>
                        </GroupBox>

                        <TextBlock Text="Mevcut Durum:" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding SessionStatusText}" Margin="0,5,0,15" MinHeight="30" TextWrapping="Wrap" Background="#eee" Padding="5"/>

                        <TextBlock Text="Erişim Kodu:" Margin="0,10,0,0" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding AccessCode, UpdateSourceTrigger=PropertyChanged}" 
                                 FontSize="16" Margin="0,5,0,15" Padding="5"/>

                        <Button Content="Giriş Yap (Kodu Doğrula)" 
                                Command="{Binding ValidateCodeCmd}" 
                                Padding="10,8" FontWeight="Bold" Background="LightSkyBlue"/>

                        <Button Content="Oturumu Kapat (Operator Rolüne Dön)" 
                                Command="{Binding LogoutCmd}" 
                                Padding="10,8" Margin="0,10,0,0" Background="LightSalmon"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Analiz}">
            <DockPanel Margin="12">
                <StackPanel DockPanel.Dock="Top" Orientation="Vertical">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Başlangıç Tarihi:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <DatePicker SelectedDate="{Binding AnalizBaslangic}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Text="{Binding AnalizBaslangicSaat}" Width="50" VerticalAlignment="Center" Margin="0,0,15,0" ToolTip="Saat (HH:mm)"/>

                        <TextBlock Text="Bitiş Tarihi:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <DatePicker SelectedDate="{Binding AnalizBitis}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Text="{Binding AnalizBitisSaat}" Width="50" VerticalAlignment="Center" Margin="0,0,15,0" ToolTip="Saat (HH:mm)"/>
                        <Button Content="Veri Getir" 
                                Command="{Binding LoadAnalizDataCmd}" 
                                Padding="12,6" FontWeight="Bold" Margin="0,0,5,0"/>
                        <Button Content="PDF Rapor Al" 
                                Command="{Binding ExportAnalizPdfCmd}" 
                                Padding="12,6" Background="LightGreen"/>
                    </StackPanel>

                    <UniformGrid Rows="1" Columns="3" Margin="0,10,0,10">
                        <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="TOPLAM İŞ" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                                <TextBlock Text="{Binding AnalizToplamIs}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="TOPLAM KESİM (mm)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                                <TextBlock Text="{Binding AnalizToplamKesim, StringFormat={}{0:F0} mm}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="ORTALAMA SÜRE (sn)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                                <TextBlock Text="{Binding AnalizOrtalamaSure, StringFormat={}{0:F1} sn}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                </StackPanel>

                <TabControl Margin="0,10,0,0">
                    <TabItem Header="Zaman Serisi (İş Süreleri)">
                        <lvc:CartesianChart
                            Series="{Binding AnalizZamanSerisi}"
                            XAxes="{Binding AnalizXAxis}"
                            Margin="10"/>
                    </TabItem>
                    <TabItem Header="Malzeme Kırılımı (Toplam Kesim)">
                        <lvc:PieChart
                            Series="{Binding AnalizMalzemeKirilim}"
                            Margin="10"/>
                    </TabItem>
                </TabControl>
            </DockPanel>
        </Grid>

        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=KPI}">
            <StackPanel Margin="12">
                <Button Content="KPI Verilerini Hesapla (Simülasyon)" 
                        Command="{Binding LoadKpiDataCmd}" 
                        Padding="12,6" FontWeight="Bold" HorizontalAlignment="Left" Margin="0,0,0,15"/>

                <TextBlock Text="Bakım Anahtar Performans Göstergeleri (Son 30 Gün)" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,10"/>

                <UniformGrid Rows="1" Columns="3" Margin="0,10,0,10">
                    <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                        <StackPanel>
                            <TextBlock Text="KULLANILABİLİRLİK (AVAILABILITY)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                            <TextBlock Text="{Binding KpiAvailability, StringFormat={}{0:F1} %}" FontSize="28" FontWeight="Bold" Foreground="#006400"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                        <StackPanel>
                            <TextBlock Text="ARIZALAR ARASI SÜRE (MTBF)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                            <TextBlock Text="{Binding KpiMtbf, StringFormat={}{0:F2} saat}" FontSize="28" FontWeight="Bold" Foreground="#111"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#f0f0f0" BorderBrush="#ccc" BorderThickness="1" Margin="5" Padding="15">
                        <StackPanel>
                            <TextBlock Text="ORTALAMA ONARIM SÜRESİ (MTTR)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                            <TextBlock Text="{Binding KpiMttr, StringFormat={}{0:F2} saat}" FontSize="28" FontWeight="Bold" Foreground="#8B0000"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1"
              Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Dogrulama}">
            <Grid Margin="15" MaxWidth="1000">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <GroupBox Header="İmzalı Rapor Doğrulama" Grid.Row="0" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Bu ekran, oluşturulmuş PDF raporlarının değiştirilmediğini (bütünlüğünü) ve raporlama zincirinin tutarlı olduğunu doğrular." TextWrapping="Wrap" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="İmza Listesini Yenile" 
                                    Command="{Binding LoadVerifyReportListCmd}" 
                                    Padding="10,6" FontWeight="SemiBold"/>
                            <ComboBox ItemsSource="{Binding VerifyReportList}" 
                                      SelectedItem="{Binding VerifySelectedReport}"
                                      MinWidth="300" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Button Content="Doğrulamak için PDF Dosyası Seç..." 
                                Command="{Binding VerifySelectedFileCmd}" 
                                Padding="10,8" FontWeight="Bold" Background="LightSkyBlue" Margin="0,15,0,0"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Çıktı Göstergeleri" Grid.Row="1" Margin="0,15,0,0" Padding="10">
                    <UniformGrid Rows="1" Columns="2">

                        <Border BorderBrush="Gray" BorderThickness="1" Margin="5" Padding="15">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="White"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding VerifyHashUyumlu}" Value="True">
                                            <Setter Property="Background" Value="#E0FFE0"/>
                                            <Setter Property="BorderBrush" Value="Green"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding VerifyHashUyumlu}" Value="False">
                                            <Setter Property="Background" Value="#FFF0F0"/>
                                            <Setter Property="BorderBrush" Value="Red"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <StackPanel>
                                <TextBlock Text="Dosya Bütünlüğü (Hash Uyumu)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="Gray">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Test Edilmedi"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VerifyHashUyumlu}" Value="True">
                                                    <Setter Property="Text" Value="GEÇTİ (Uyumlu)"/>
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding VerifyHashUyumlu}" Value="False">
                                                    <Setter Property="Text" Value="KALDI (Değiştirilmiş!)"/>
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <Border BorderBrush="Gray" BorderThickness="1" Margin="5" Padding="15">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="White"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding VerifyZincirTutarlı}" Value="True">
                                            <Setter Property="Background" Value="#E0FFE0"/>
                                            <Setter Property="BorderBrush" Value="Green"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding VerifyZincirTutarlı}" Value="False">
                                            <Setter Property="Background" Value="#FFF0F0"/>
                                            <Setter Property="BorderBrush" Value="Red"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <StackPanel>
                                <TextBlock Text="Rapor Zinciri (Bağlantı)" FontSize="14" FontWeight="SemiBold" Foreground="#555"/>
                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="Gray">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Test Edilmedi"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VerifyZincirTutarlı}" Value="True">
                                                    <Setter Property="Text" Value="GEÇTİ (Tutarlı)"/>
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding VerifyZincirTutarlı}" Value="False">
                                                    <Setter Property="Text" Value="KALDI (Kırık Zincir!)"/>
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                </GroupBox>

                <GroupBox Header="Doğrulama Sonucu" Grid.Row="2" Margin="0,15,0,0">
                    <TextBlock Text="{Binding VerifyResultText}" 
                               FontSize="16" TextWrapping="Wrap" 
                               Padding="10" Background="#eee"/>
                </GroupBox>

            </Grid>

            <Popup IsOpen="{Binding IsFlyoutOpen}"
               Placement="Right"
               AllowsTransparency="True"
               PopupAnimation="Slide">
                <Border Background="WhiteSmoke" BorderBrush="Gray" BorderThickness="1" MinWidth="300" Margin="10">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="2" Color="Gray" Opacity="0.5" BlurRadius="5"/>
                    </Border.Effect>

                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                            <TextBlock Text="Hızlı Erişim Kısayolları" FontWeight="Bold" Margin="0,0,0,10"/>
                            <Button Content="Verileri Yenile" Command="{Binding LoadAnalizDataCmd}" Margin="0,3"/>
                            <Button Content="PDF Dışa Aktar" Command="{Binding ExportAnalizPdfCmd}" Margin="0,3"/>
                            <Button Content="Parametre Kaydet" Command="{Binding SaveParamsCmd}" Margin="0,3"/>
                            <Separator Margin="0,5"/>
                            <Button Content="Üretimi Başlat" Command="{Binding StartCmd}" Margin="0,3" Background="LightGreen"/>
                            <Button Content="Üretimi Durdur" Command="{Binding StopCmd}" Margin="0,3" Background="LightSalmon"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                            <TextBlock Text="Makine Joystick" FontWeight="Bold" Margin="0,0,0,10" HorizontalAlignment="Center"/>
                            <Border BorderBrush="Black" BorderThickness="1" Background="LightGray" Width="150" Height="150" CornerRadius="75" Margin="10">
                                <Ellipse Width="50" Height="50" Fill="DarkGray" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="X: 0.00 Y: 0.00" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Popup>
        </Grid>

        <!-- ALT KONTROL BAR -->
        <GroupBox Header="Makine / Kesim / Süreç" Grid.Row="2" Margin="0,8,0,8"
          Visibility="{Binding SelectedPage, Converter={StaticResource EnumToVis}, ConverterParameter=Uretim}">
            <UniformGrid Rows="1" Columns="6" Margin="8">

                <Button Content="Simülasyon" Command="{Binding StartSimCmd}" Padding="12,6"/>
                <Button Content="Sıfırla"     Command="{Binding ResetCmd}"    Padding="12,6"/>
                <Button Content="Başlat"      Command="{Binding StartCmd}"    Padding="12,6"/>
                <Button Content="Durdur"      Command="{Binding StopCmd}"     Padding="12,6"/>
                <Button Content="Devam Et"    Command="{Binding ResumeCmd}"   Padding="12,6"/>
                <Button Content="Acil Durdurma" Command="{Binding EStopCmd}"  Padding="12,6" Background="#ffdddd"/>
            </UniformGrid>
        </GroupBox>

        <!-- EVENTS / ALARMS -->
        <GroupBox Grid.Row="3" Header="Events / Alarms" Margin="0,8,0,8">
            <ListView ItemsSource="{Binding Events}" Margin="8"
                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Time" Width="170">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Timestamp, StringFormat=dd.MM.yyyy HH:mm:ss}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Level" Width="80" DisplayMemberBinding="{Binding Level}"/>
                        <GridViewColumn Header="Source" Width="120" DisplayMemberBinding="{Binding Source}"/>
                        <GridViewColumn Header="Message" Width="700" DisplayMemberBinding="{Binding Message}"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </GroupBox>

        <!-- STATUS -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <TextBlock Text="{Binding Status}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem Content="{Binding NcPath}"/>

            <StatusBarItem HorizontalAlignment="Right">
                <Button Content="Operatör Paneli ☰" 
                        Command="{Binding ToggleFlyoutCmd}" 
                        FontWeight="Bold" Background="AliceBlue"/>
            </StatusBarItem>
        </StatusBar>

    </Grid>
</Window>
